<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Statistics ‚Äì FileConverter Pro</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>

<body>

    <nav class="navbar" id="navbar">
        <div class="nav-container">
            <a href="/" class="nav-logo">
                <div class="logo-icon"><i class="fas fa-bolt"></i></div>
                <span class="logo-text">FileConverter<span class="logo-pro">Pro</span></span>
            </a>
            <button class="nav-toggle" id="navToggle"><span></span><span></span><span></span></button>
            <div class="nav-menu" id="navMenu">
                <div class="nav-dropdown">
                    <button class="nav-link dropdown-btn"><i class="fas fa-file-pdf"></i> PDF <i
                            class="fas fa-chevron-down fa-xs"></i></button>
                    <div class="dropdown-content">
                        <th:block th:each="t : ${toolsByCategory['PDF']}">
                            <a th:href="@{'/tool/' + ${t.id}}" class="dropdown-item"><span th:text="${t.icon}"></span>
                                <span th:text="${t.name}"></span></a>
                        </th:block>
                    </div>
                </div>
                <a href="/stats" class="nav-link active"><i class="fas fa-chart-pie"></i> Stats</a>
            </div>
        </div>
    </nav>

    <section class="stats-hero">
        <div class="container">
            <div class="section-header">
                <span class="section-tag">üìä Analytics</span>
                <h1 class="section-title">Conversion Statistics</h1>
                <p class="section-subtitle">Real-time usage data across all our tools</p>
            </div>
        </div>
    </section>

    <section class="section">
        <div class="container">
            <!-- Summary Cards -->
            <div class="stats-summary">
                <div class="stats-card">
                    <div class="stats-card-icon" style="background:#6c63ff20; color:#6c63ff">
                        <i class="fas fa-exchange-alt"></i>
                    </div>
                    <div class="stats-card-info">
                        <span class="stats-card-number" th:text="${stats.totalConversionsValue}">0</span>
                        <span class="stats-card-label">Total Conversions</span>
                    </div>
                </div>
                <div class="stats-card">
                    <div class="stats-card-icon" style="background:#2ecc7120; color:#2ecc71">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="stats-card-info">
                        <span class="stats-card-number" th:text="${stats.successCountValue}">0</span>
                        <span class="stats-card-label">Successful</span>
                    </div>
                </div>
                <div class="stats-card">
                    <div class="stats-card-icon" style="background:#e74c3c20; color:#e74c3c">
                        <i class="fas fa-times-circle"></i>
                    </div>
                    <div class="stats-card-info">
                        <span class="stats-card-number" th:text="${stats.failureCountValue}">0</span>
                        <span class="stats-card-label">Failed</span>
                    </div>
                </div>
                <div class="stats-card">
                    <div class="stats-card-icon" style="background:#f39c1220; color:#f39c12">
                        <i class="fas fa-tools"></i>
                    </div>
                    <div class="stats-card-info">
                        <span class="stats-card-number" th:text="${#lists.size(allTools)}">35</span>
                        <span class="stats-card-label">Available Tools</span>
                    </div>
                </div>
            </div>

            <!-- Charts Row -->
            <div class="charts-row">
                <!-- Pie Chart -->
                <div class="chart-card">
                    <h3 class="chart-title"><i class="fas fa-chart-pie"></i> Conversions by Category</h3>
                    <div class="chart-wrapper">
                        <canvas id="pieChart"></canvas>
                    </div>
                    <div class="chart-legend" id="chartLegend"></div>
                </div>

                <!-- Bar Chart -->
                <div class="chart-card">
                    <h3 class="chart-title"><i class="fas fa-chart-bar"></i> Success vs Failed</h3>
                    <div class="chart-wrapper">
                        <canvas id="barChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Category Breakdown Table -->
            <div class="stats-table-card">
                <h3 class="chart-title"><i class="fas fa-table"></i> Category Breakdown</h3>
                <div th:if="${stats.categoryMap == null or stats.categoryMap.isEmpty()}" class="empty-stats">
                    <div class="empty-icon">üìä</div>
                    <h4>No conversions yet</h4>
                    <p>Start converting files to see statistics here</p>
                    <a href="/" class="btn-convert" style="text-decoration:none; display:inline-flex; margin-top:1rem;">
                        <i class="fas fa-magic"></i> Try a Tool
                    </a>
                </div>
                <table class="stats-table" th:if="${stats.categoryMap != null and !stats.categoryMap.isEmpty()}">
                    <thead>
                        <tr>
                            <th>Category</th>
                            <th>Conversions</th>
                            <th>Share</th>
                            <th>Progress</th>
                        </tr>
                    </thead>
                    <tbody>
                        <th:block th:each="entry : ${stats.categoryMap}">
                            <tr>
                                <td><strong th:text="${entry.key}">Category</strong></td>
                                <td><span th:text="${entry.value}">0</span></td>
                                <td
                                    th:text="${stats.totalConversionsValue > 0 ? #numbers.formatDecimal(entry.value * 100.0 / stats.totalConversionsValue, 1, 1) + '%' : '0%'}">
                                    0%</td>
                                <td>
                                    <div class="table-progress">
                                        <div class="table-progress-fill"
                                            th:style="'width:' + (${stats.totalConversionsValue > 0 ? entry.value * 100 / stats.totalConversionsValue : 0}) + '%'">
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </th:block>
                    </tbody>
                </table>
            </div>
        </div>
    </section>

    <footer class="footer">
        <div class="container">
            <div class="footer-bottom">
                <p>¬© 2025 FileConverter Pro ¬∑ Built with ‚ù§Ô∏è using Java 21 & Spring Boot</p>
            </div>
        </div>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
    <script th:src="@{/js/main.js}"></script>
    <script th:inline="javascript">
        const statsData = /*[[${stats.categoryMap}]]*/ {};
        const totalConversions = /*[[${stats.totalConversionsValue}]]*/ 0;
        const successCount = /*[[${stats.successCountValue}]]*/ 0;
        const failureCount = /*[[${stats.failureCountValue}]]*/ 0;
        initStatsPage(statsData, totalConversions, successCount, failureCount);
    </script>
</body>

</html>